<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no"/>
    <title>NOW IN THEATER</title>
    <script src="js/jquery-3.6.0.min.js"></script>
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/active.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="wrap">
        <!-- 헤더 -->
        <header>
            <nav>
                <div class="inner">
                    <div class="mo_top-header">
                        <h1 class="logo"><a href="index.html"><img src="img/logo.png" alt=""></a></h1>
                        <button class="open_menu-btn"></button>
                    </div>
                    <div class="mo_menu">
                        <div class="top">
                            <button class="close_menu-btn"></button>
                        </div>
                        <ul class="menu-list">
                            <li class="menu_sns">
                                <ul>
                                    <li class="sns-youtube"><a href="https://www.youtube.com/SHOWBOXmovie" target="_blank"></a></li>
                                    <li class="sns-instagram"><a href="https://www.instagram.com/showbox.movie/" target="_blank"></a></li>
                                    <li class="sns-facebook"><a href="https://www.facebook.com/Showbox.Movie" target="_blank"></a></li>
                                </ul>
                            </li>
                            <li>
                                <a href="#" class="title">SHOWBOX MOVIE</a>
                                <ul class="sub-menu">
                                    <li><a href="lineup.html">LINE-UP</a></li>
                                    <li><a href="now.html">NOW IN THEATERS</a></li>
                                </ul>
                            </li>
                            <li>
                                <a href="#" class="title">COMPANY</a>
                                <ul class="sub-menu">
                                    <li><a href="company.html">SHOWBOX</a></li>
                                    <li><a href="history.html">HISTORY</a></li>
                                    <li><a href="map.html">MAP</a></li>
                                </ul>
                            </li>
                            <li>
                                <a href="#" class="title">IR</a>
                                <ul class="sub-menu">
                                    <li><a href="notice.html">NOTICE</a></li>
                                    <li><a href="recruit.html">RECRUIT</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div class="dt_menu">
                        <ul>
                            <li><a href="lineup.html">SHOWBOX MOVIE</a></li>
                            <li><a href="company.html">COMPANY</a></li>
                            <li><a href="notice.html">IR</a></li>
                        </ul>
                        <div class="sub-menu">
                            <ul>
                                <li>
                                    <a href="lineup.html" class="title">SHOWBOX MOVIE</a>
                                    <ul>
                                        <li><a href="lineup.html">LINE-UP</a></li>
                                        <li><a href="now.html">NOW IN THEATERS</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <a href="company.html" class="title">COMPANY</a>
                                    <ul>
                                        <li><a href="company.html">SHOWBOX</a></li>
                                        <li><a href="history.html">HISTORY</a></li>
                                        <li><a href="map.html">MAP</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <a href="notice.html" class="title">IR</a>
                                    <ul>
                                        <li><a href="notice.html">NOTICE</a></li>
                                        <li><a href="recruit.html">RECRUIT</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>
        </header>


        <div class="movie-contents">
            <div class="inner">
                <div class="top">
                    <h2>SHOWBOX MOVIE</h2>
                    <div class="menu-list">
                        <ul>
                            <li class="active"><a href="lineup.html">LINE-UP</a></li>
                            <li><a href="now.html">NOW IN THEATERS</a></li>
                        </ul>
                    </div>
                </div>

                <div class="mid">
                    <div class="search-wrap">
                        <input name="search" type="text" placeholder="검색어를 입력하세요." onkeyup="enterKey();" class="search">
                    </div>
                    <div class="movie-wrap"></div>
                    <button class="more-btn">더보기</button>
                </div>
            </div>
        </div>

        <!-- 푸터 -->
        <footer style="border-top: 1px solid #ddd;">
            <div class="inner">
                <div class="top">
                    <div class="img-box"><img src="img/logo.png" alt="푸터 로고"></div>
                </div>
                <div class="txt">
                    주소 서울특별시 강남구 도산대로 310(논현동) 916빌딩 7~9층
                    <br> 전화 070-8854-1158
                    <br> 이메일 jeongjw@showbox.co.kr
                </div>
                <div class="link">
                    <a href="https://showbox.irpage.co.kr/#/agreements/terms-service" target="_blank">이용약관</a>
                    <a href="https://showbox.irpage.co.kr/#/agreements/privacy-policy" target="_blank">개인정보 처리방침</a>
                    <small>© 2019 SHOWBOX All rights reserved.</small>
                </div>
            </div>
        </footer>

        <!-- 맨위로 -->
        <div class="scroll-top">
            <a href="#"></a>
        </div>
    </div>
    <script>
        let page = 1;
        // const key = "c419c959580ade242b9ff7e6a664f241";
        // const base_url = "https://image.tmdb.org/t/p/w300/";
        const container = document.querySelector(".movie-wrap");
        
        const options = {
            method: 'GET',
            headers: {
                accept: 'application/json',
                Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJjNDE5Yzk1OTU4MGFkZTI0MmI5ZmY3ZTZhNjY0ZjI0MSIsInN1YiI6IjYyMjk5NjllMTA5Y2QwMDA0NTkyNGVmMiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.cE41jpVp7Ygww8zxlTMu1A3t7tvlAb1kr9nXZZEGNJM'
            }
        };

        function fetchMovie () {

            fetch(`https://api.themoviedb.org/3/movie/popular?language=ko-KO&page=${page}`, options)
            .then(response => response.json())
            .then(response => {
                console.log(response);
                let movieList = response['results'];
                //결과값을 배열로 만들어서 movieList에 넣었다

                movieList.forEach(i => {
                    let movieTitle = i['title'];
                    let poster = 'https://image.tmdb.org/t/p/w300' + i['poster_path'];
                    let movieOverview = i['overview'];

                const div = document.createElement("div");
                const output = `
                    <div class="img-wrap"><img src="${poster}" alt="${movieTitle}"></img></div>
                    <div class="movie-title"><a href="">${movieTitle}</a></div>
                    <div class="movie-overview"><p>${movieOverview}</p></div>
                    
                `;
                div.innerHTML = output;
                container.appendChild(div); 

                });
                console.log(movieList)
            })
            .catch(err => console.error(err));

        };
        window.addEventListener("onLoad", fetchMovie());
        //화면 불러오기 (출력)

    
        //더보기 버튼 클릭
        const moreButton = document.querySelector(".more-btn");
        moreButton.addEventListener('click', function(){
            if(page < 5){
                page += 1;
                fetchMovie(page);
            } else {
                this.disabled = true;
            }
        });

        // function fetchMovie(page){
        //     const url = `https://api.themoviedb.org/3/movie/popular?api_key=${key}&language=ko-KR&page=${page}`;
        //     fetch(url)
        //     .then(res => res.json())
        //     .then(function(res){
        //         const movies = res.results;
        //         movies.map(function(movie){
        //             console.log(movie.title);
        //             const div = document.createElement('div');
        //             const output = `
        //                 <div class="movie-img">
        //                     <img src="${base_url + movie.poster_path}">
        //                 </div>
        //                 <h2 class="movie-title">${movie.title}</h2>
        //                 <p class="movie-overview">${movie.overview}</p>
        //                 <p class="release_date">개봉일: ${movie.release_date}</p>
        //             `;
        //             div.innerHTML = output;
        //             container.appendChild(div);
        //         });
        //     })
        //     .catch(erro => console.log(erro));
        // };
        
        // window.addEventListener('onLoad', fetchMovie());

        function enterKey () {
            if (window.event.keyCode == 13) { 
                var movieName = document.querySelector('.search').value;
                container.innerHTML = '';
                searchMovie(movieName);
            }
        }

        function searchMovie(movieName){
            const url = `https://api.themoviedb.org/3/search/movie?api_key=${key}&language=ko-KR&page=${page}&query=${movieName}`;
            fetch(url)
            .then(res => res.json())
            .then(function(res){
                const movies = res.results;
                movies.map(function(movie){
                    console.log(movie.title);
                    const div = document.createElement('div');
                    const output = `
                        <div class="movie-img">
                            <img src="${base_url + movie.poster_path}">
                        </div>
                        <h2 class="movie-title">${movie.title}</h2>
                        <p class="movie-overview">${movie.overview}</p>
                        <p class="release_date">개봉일: ${movie.release_date}</p>
                    `;
                    div.innerHTML = output;
                    container.appendChild(div);
                });
            })
            .catch(erro => console.log(erro));
        }



    </script>
    <script src="js/script.js"></script>
</body>
</html>